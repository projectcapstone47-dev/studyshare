<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="StudyShare - Simple study material exchange platform for engineering students">
    <title>StudyShare - Knowledge Sharing Platform</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="logo">
                <h1>üìö StudyShare</h1>
            </div>
            <nav class="nav" id="mainNav">
                <!-- Will be populated by JavaScript based on auth status -->
            </nav>
        </div>
    </header>

    <main class="hero">
        <div class="container">
            <div class="hero-content">
                <h2>Simplifying Knowledge Sharing for Engineering Students</h2>
                <p>Share notes, assignments, and study materials with your peers. Learn together, grow together.</p>
                <div class="cta-buttons" id="ctaButtons">
                    <!-- Will be populated by JavaScript based on auth status -->
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="totalMaterials">0</h3>
                    <p>Study Materials</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalDownloads">0</h3>
                    <p>Total Downloads</p>
                </div>
                <div class="stat-card">
                    <h3 id="totalSubjects">0</h3>
                    <p>Subjects</p>
                </div>
                <div class="stat-card">
                    <h3 id="verifiedMaterials">0</h3>
                    <p>Verified Materials</p>
                </div>
            </div>
        </div>
    </main>

    <section class="features">
        <div class="container">
            <h2>Features</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="icon">üì§</div>
                    <h3>Easy Upload</h3>
                    <p>Upload PDFs, DOCs, PPTs, and images with just a few clicks</p>
                </div>
                <div class="feature-card">
                    <div class="icon">üîç</div>
                    <h3>Smart Search</h3>
                    <p>Find materials by subject, semester, or keywords instantly</p>
                </div>
                <div class="feature-card">
                    <div class="icon">üë•</div>
                    <h3>Group Collaboration</h3>
                    <p>Create study groups and share materials with your classmates</p>
                </div>
                <div class="feature-card">
                    <div class="icon">‚úÖ</div>
                    <h3>Verified Content</h3>
                    <p>Teacher-uploaded materials are verified and high quality</p>
                </div>
                <div class="feature-card">
                    <div class="icon">üéì</div>
                    <h3>For Students & Teachers</h3>
                    <p>Separate accounts for students and teachers with role-based features</p>
                </div>
                <div class="feature-card">
                    <div class="icon">üîí</div>
                    <h3>Secure & Private</h3>
                    <p>Your data is protected with industry-standard security</p>
                </div>
            </div>
        </div>
    </section>

    <section class="recent-materials">
        <div class="container">
            <h2>Recent Uploads</h2>
            <div id="recentMaterialsList" class="materials-grid">
                <p>Loading recent materials...</p>
            </div>
            <div class="text-center">
                <a href="/browse.html" class="btn btn-secondary">View All Materials</a>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 StudyShare. Built for engineering students, by students.</p>
        </div>
    </footer>

    <script src="../js/main.js"></script>
    <script>
        // Check authentication and update UI
        function updateUIBasedOnAuth() {
            const token = localStorage.getItem('token');
            const user = JSON.parse(localStorage.getItem('user') || '{}');
            const nav = document.getElementById('mainNav');
            const ctaButtons = document.getElementById('ctaButtons');

            if (token && user.id) {
                // User is logged in
                nav.innerHTML = `
                    <a href="/dashboard.html">Dashboard</a>
                    <a href="/upload.html">Upload</a>
                    <a href="/browse.html">Browse</a>
                    <a href="/groups.html">Groups</a>
                    <div class="user-menu">
                        <span>${escapeHtml(user.name || 'User')}</span>
                        <div class="dropdown">
                            <a href="/profile.html">Profile</a>
                            <a href="#" id="logoutBtn">Logout</a>
                        </div>
                    </div>
                `;

                ctaButtons.innerHTML = `
                    <a href="/dashboard.html" class="btn btn-primary">Go to Dashboard</a>
                    <a href="/upload.html" class="btn btn-secondary">Upload Material</a>
                `;

                // Logout handler
                document.getElementById('logoutBtn').addEventListener('click', async (e) => {
                    e.preventDefault();
                    try {
                        await fetch('/api/auth/logout', {
                            method: 'POST',
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                    } catch (error) {
                        console.error('Logout error:', error);
                    }
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    window.location.reload();
                });
            } else {
                // User is not logged in
                nav.innerHTML = `
                    <a href="/">Home</a>
                    <a href="/browse.html">Browse</a>
                    <a href="/about.html">About</a>
                    <a href="/login.html" class="btn btn-small btn-primary">Login</a>
                    <a href="/register.html" class="btn btn-small btn-secondary">Register</a>
                `;

                ctaButtons.innerHTML = `
                    <a href="/register.html" class="btn btn-primary">Get Started</a>
                    <a href="/browse.html" class="btn btn-secondary">Browse Materials</a>
                `;
            }
        }

        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch('/api/materials/stats/overview');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('totalMaterials').textContent = data.data.total_materials || 0;
                    document.getElementById('totalDownloads').textContent = data.data.total_downloads || 0;
                    document.getElementById('totalSubjects').textContent = data.data.total_subjects || 0;
                    document.getElementById('verifiedMaterials').textContent = data.data.verified_materials || 0;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }

        // Load recent materials
        async function loadRecentMaterials() {
            try {
                const response = await fetch('/api/search/recent?limit=6');
                const data = await response.json();
                
                const container = document.getElementById('recentMaterialsList');
                
                if (data.success && data.data.length > 0) {
                    container.innerHTML = data.data.map(material => `
                        <div class="material-card">
                            <div class="material-icon">${getFileIcon(material.file_type)}</div>
                            ${material.is_verified ? '<span class="verified-badge">‚úì Verified</span>' : ''}
                            <h4>${escapeHtml(material.title)}</h4>
                            <p class="material-meta">
                                ${escapeHtml(material.subject)} ‚Ä¢ Sem ${material.semester}
                            </p>
                            <p class="material-uploader">
                                <span class="role-indicator ${material.uploader_role}">${material.uploader_role === 'teacher' ? 'üë®‚Äçüè´' : 'üë®‚Äçüéì'}</span>
                                ${escapeHtml(material.uploaded_by)}
                            </p>
                            <a href="/api/materials/${material.id}/download" class="btn btn-small">Download</a>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<p>No materials uploaded yet. Be the first to share!</p>';
                }
            } catch (error) {
                console.error('Error loading materials:', error);
                document.getElementById('recentMaterialsList').innerHTML = '<p>Error loading materials</p>';
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            updateUIBasedOnAuth();
            loadStats();
            loadRecentMaterials();
        });
    </script>
</body>
</html>
